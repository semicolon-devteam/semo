# Test Policy (Flexible TDD)

> 작업 유형과 레이어에 따른 유연한 테스트 정책

## 핵심 원칙

**"테스트는 품질 보장 도구이지, 개발 속도를 저하시키는 의무가 아니다"**

- 복잡한 비즈니스 로직: TDD 필수
- 단순 UI/스타일: E2E로 대체 가능
- 경미한 수정: 테스트 생략 허용

---

## 작업 유형별 테스트 정책

| 작업 유형 | 테스트 정책 | 근거 |
|----------|------------|------|
| **SDD (새 기능)** | ✅ TDD 권장 | 복잡한 로직, 장기 유지보수 |
| **버그 수정** | ⚠️ 재현 테스트 권장 | 리그레션 방지 |
| **UI/스타일 변경** | 🔄 E2E 대체 가능 | 시각적 검증은 E2E로 충분 |
| **Fast-track** | ❌ 생략 허용 | 경미한 수정 (3파일 이하) |
| **리팩토링** | ⚠️ 기존 테스트 통과 확인 | 기존 동작 보장 |

---

## 레이어별 테스트 정책

| 레이어 | Unit Test | 커버리지 목표 | 필수 여부 |
|--------|-----------|--------------|----------|
| **Repository/API Client** | ✅ 필수 | 80% | 🔴 필수 |
| **Hooks (비즈니스 로직)** | ✅ 필수 | 70% | 🔴 필수 |
| **Components (로직 포함)** | ⚠️ 권장 | 50% | 🟡 권장 |
| **Components (순수 UI)** | 🔄 E2E 대체 | - | 🟢 선택 |
| **페이지 레이아웃** | ❌ 생략 | - | 🟢 선택 |

### 레이어 판단 기준

**Repository/API Client (필수)**:
- 외부 API 호출
- 데이터 변환 로직
- 캐싱/상태 관리

**Hooks - 비즈니스 로직 (필수)**:
- 복잡한 상태 관리
- 조건부 로직
- 사이드 이펙트

**Components - 로직 포함 (권장)**:
- 폼 검증
- 조건부 렌더링 (복잡한 경우)
- 이벤트 핸들러 로직

**Components - 순수 UI (E2E 대체)**:
- 스타일링만 담당
- Props 그대로 표시
- 레이아웃 컴포넌트

---

## v0.2.x TESTS Phase 유연화

### 기존 (엄격한 TDD)

```
v0.0.x CONFIG → v0.1.x PROJECT → v0.2.x TESTS → v0.3.x DATA → v0.4.x CODE
                                       ↑
                                  "반드시 먼저"
```

### 개선 (유연한 TDD)

```
v0.0.x CONFIG → v0.1.x PROJECT → v0.3.x DATA → v0.4.x CODE
                                       ↓
                              ┌────────────────────┐
                              │ 레이어별 테스트    │
                              │ (동시 또는 후작성) │
                              └────────────────────┘
```

### Phase 진행 옵션

| 옵션 | 설명 | 적합한 경우 |
|------|------|------------|
| **A. TDD (테스트 먼저)** | v0.2.x → v0.3.x → v0.4.x | 복잡한 비즈니스 로직 |
| **B. 동시 작성** | v0.3.x + v0.4.x 중 테스트 작성 | 일반적인 기능 |
| **C. 후작성** | v0.4.x 완료 후 테스트 보강 | 프로토타이핑, 탐색 |

---

## Quality Gate (수정됨)

### PR 전 필수 체크

| 체크 | 명령어 | 기준 | 실패 시 |
|------|--------|------|---------|
| ESLint | `npm run lint` | 0 errors | PR 차단 |
| TypeScript | `npx tsc --noEmit` | 0 errors | PR 차단 |
| **기존 테스트** | `npm test` | 100% passing | PR 차단 |
| **E2E (핵심 플로우)** | `skill:e2e-test` | 콘솔 에러 0 | PR 차단 |

### 커버리지 (권장, 차단 아님)

| 레이어 | 목표 | 미달 시 |
|--------|------|---------|
| Repository | 80% | 경고 |
| Hooks | 70% | 경고 |
| Components | 50% | 정보 |

---

## 테스트 생략 허용 조건

다음 조건을 **모두** 만족하면 Unit Test 생략 가능:

1. **Fast-track 또는 UI 전용 변경**
2. **3개 파일 이하 수정**
3. **기존 테스트 전체 통과**
4. **E2E 테스트로 동작 검증 완료**

### 생략 시 출력

```markdown
[SEMO] 테스트 정책: Unit Test 생략

**사유**: {사유}
**대체 검증**: E2E 테스트 통과 ✅

⚠️ 추후 복잡도 증가 시 Unit Test 추가 권장
```

---

## E2E 테스트 우선 케이스

다음 경우 Unit Test 대신 E2E 테스트 우선:

- 순수 UI 컴포넌트 변경
- 스타일/레이아웃 수정
- 페이지 네비게이션 변경
- 반응형 디자인 수정

```markdown
[SEMO] 테스트 정책: E2E 우선

**변경 유형**: UI/스타일
**검증 방법**: skill:e2e-test

Unit Test 작성보다 E2E 테스트가 더 효과적입니다.
```

---

## 관련 문서

- [Quality Gates](quality-gates.md) - 품질 기준
- [Test Templates](test-templates.md) - 테스트 작성 템플릿
- [Browser Testing](browser-testing.md) - E2E 테스트 가이드
