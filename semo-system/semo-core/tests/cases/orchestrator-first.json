{
  "description": "Orchestrator-First Policy 테스트 - 모든 요청이 Orchestrator를 먼저 거치는지 검증",
  "version": "2.0.0",
  "tests": [
    {
      "name": "코드 구현 요청 → Orchestrator → coder 스킬 라우팅",
      "category": "skill_routing",
      "input": "댓글 기능 구현해줘",
      "expect": {
        "contains": [
          "[SEMO] Orchestrator:",
          "의도 분석"
        ],
        "contains_any": [
          "[SEMO] Skill 위임:",
          "[SEMO] Skill:",
          "coder",
          "implement"
        ],
        "sequence": [
          "Orchestrator",
          "Skill"
        ]
      },
      "simulation": {
        "expected_flow": [
          "1. [SEMO] Orchestrator: 의도 분석 완료 → 코드 구현 요청",
          "2. [SEMO] Skill 위임: semo-skills/coder/implement (platform: {auto})",
          "3. [SEMO] Skill: implement 사용"
        ],
        "verification_points": [
          "Orchestrator 메시지가 첫 번째로 출력되는가?",
          "플랫폼 자동 감지가 수행되는가?",
          "적절한 스킬이 선택되는가?"
        ]
      }
    },
    {
      "name": "테스트 요청 → Orchestrator → tester 스킬 라우팅",
      "category": "skill_routing",
      "input": "유닛 테스트 작성해줘",
      "expect": {
        "contains": [
          "[SEMO] Orchestrator:"
        ],
        "contains_any": [
          "tester",
          "테스트",
          "Skill 위임"
        ],
        "sequence": [
          "Orchestrator",
          "Skill"
        ]
      },
      "simulation": {
        "expected_flow": [
          "1. [SEMO] Orchestrator: 의도 분석 완료 → 테스트 요청",
          "2. [SEMO] Skill 위임: semo-skills/tester/",
          "3. [SEMO] Skill: tester 사용"
        ],
        "verification_points": [
          "테스트 카테고리로 정확히 분류되는가?",
          "tester 스킬로 라우팅되는가?"
        ]
      }
    },
    {
      "name": "기획 요청 → Orchestrator → planner 스킬 라우팅",
      "category": "skill_routing",
      "input": "이번 스프린트 Epic을 작성해줘",
      "expect": {
        "contains": [
          "[SEMO] Orchestrator:"
        ],
        "contains_any": [
          "planner",
          "기획",
          "Skill 위임"
        ],
        "sequence": [
          "Orchestrator",
          "Skill"
        ]
      },
      "simulation": {
        "expected_flow": [
          "1. [SEMO] Orchestrator: 의도 분석 완료 → 기획 요청",
          "2. [SEMO] Skill 위임: semo-skills/planner/",
          "3. [SEMO] Skill: planner 사용"
        ]
      }
    },
    {
      "name": "메모리 저장 요청 → Orchestrator → memory 스킬 라우팅",
      "category": "skill_routing",
      "input": "이 결정 사항 기억해줘: API는 JSON Envelope 패턴 사용",
      "expect": {
        "contains": [
          "[SEMO] Orchestrator:"
        ],
        "contains_any": [
          "memory",
          "메모리",
          "Skill"
        ]
      },
      "simulation": {
        "expected_flow": [
          "1. [SEMO] Orchestrator: 의도 분석 완료 → 메모리 저장 요청",
          "2. [SEMO] Skill 위임: semo-skills/memory/",
          "3. [SEMO] Skill: memory 호출 - save"
        ]
      }
    },
    {
      "name": "Slack 알림 요청 → Orchestrator → notify-slack 스킬 라우팅",
      "category": "skill_routing",
      "input": "배포 완료 알림을 슬랙에 보내줘",
      "expect": {
        "contains": [
          "[SEMO] Orchestrator:"
        ],
        "contains_any": [
          "notify-slack",
          "Slack",
          "슬랙"
        ]
      },
      "simulation": {
        "expected_flow": [
          "1. [SEMO] Orchestrator: 의도 분석 완료 → Slack 알림 요청",
          "2. [SEMO] Skill 위임: semo-skills/notify-slack/",
          "3. [SEMO] Skill: notify-slack 사용"
        ]
      }
    },
    {
      "name": "단순 질문 → Orchestrator 생략 허용",
      "category": "exception",
      "input": "이 함수가 뭐하는 거야?",
      "expect": {
        "not_contains": [
          "[SEMO] Skill 위임:"
        ]
      },
      "simulation": {
        "expected_flow": [
          "Orchestrator 생략 - 단순 질문으로 판단",
          "직접 응답"
        ],
        "note": "단순 질문은 예외 케이스로 Orchestrator를 거치지 않아도 됨"
      }
    },
    {
      "name": "인사말 → Orchestrator 생략 허용",
      "category": "exception",
      "input": "안녕!",
      "expect": {
        "not_contains": [
          "[SEMO] Orchestrator:",
          "[SEMO] Skill:"
        ]
      },
      "simulation": {
        "expected_flow": [
          "Orchestrator 생략 - 일반 대화",
          "직접 응답"
        ]
      }
    },
    {
      "name": "SEMO 메시지 포맷 검증 - 별도 줄 출력",
      "category": "message_format",
      "input": "새 API 엔드포인트 추가해줘",
      "expect": {
        "pattern": "\\[SEMO\\] [A-Za-z]+:",
        "not_contains": [
          "[SEMO] Orchestrator:[SEMO]",
          "[SEMO] Skill:[SEMO]"
        ]
      },
      "simulation": {
        "expected_format": "[SEMO] Orchestrator: 의도 분석 완료 → 코드 구현\n\n[SEMO] Skill 위임: ...",
        "verification_points": [
          "각 SEMO 메시지가 별도 줄에 있는가?",
          "메시지 사이에 빈 줄이 있는가?"
        ]
      }
    },
    {
      "name": "레거시 접두사 → Orchestrator 경고 후 라우팅",
      "category": "legacy_compat",
      "input": "[next] 컴포넌트 만들어줘",
      "expect": {
        "contains_any": [
          "[SEMO] Warning:",
          "[SEMO] Orchestrator:",
          "coder"
        ]
      },
      "simulation": {
        "expected_flow": [
          "1. [SEMO] Warning: [next] 접두사는 6개월 후 제거 예정",
          "2. [SEMO] Orchestrator: 의도 분석 완료 → 코드 구현 요청",
          "3. [SEMO] Skill 위임: semo-skills/coder/implement (platform: nextjs)"
        ]
      }
    },
    {
      "name": "라우팅 실패 시 직접 처리 폴백",
      "category": "fallback",
      "input": "점심 뭐 먹을까?",
      "expect": {
        "contains_any": [
          "라우팅 실패",
          "적절한 Skill 없음",
          "직접 처리"
        ]
      },
      "simulation": {
        "expected_flow": [
          "1. [SEMO] Orchestrator: 라우팅 실패 → 적절한 Skill 없음",
          "2. 직접 처리 (Claude Code 기본 동작)"
        ]
      }
    }
  ]
}
