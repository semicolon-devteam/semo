# 00-Overview: Clarify & Spike

> 전체 시스템 아키텍처에 대한 불확실성 제거 및 기술 검증

---

## Clarify (명확화 필요 사항)

### 1. 프로젝트 범위 및 우선순위

**질문**:
- MVP 버전(v0.1.0)에 반드시 포함되어야 할 최소 기능은?
- Epic 6-8이 없는 이유는? 향후 추가 예정인가?
- 각 Phase의 실제 배포 시점은 언제인가?

**결정 필요**:
- Office당 Agent 수 제한 (기본안: 8개 역할)
- 동시 Office 수 제한 (단일 서버 기준)
- 데모/프로덕션 환경 분리 시점

### 2. 비즈니스 규칙

**질문**:
- Office 생성 권한: 누구나 생성 가능한가? 인증 필요한가?
- Office 삭제 정책: 언제 자동 삭제? 데이터 보존 기간?
- Agent 비용 산정: 실행 시간 기반? 토큰 사용량 기반?

**결정 필요**:
- 무료/유료 플랜 구분 여부
- SLA 목표 (응답 시간, 가용성)
- 데이터 백업 정책

### 3. 아키텍처 결정

**질문**:
- Supabase vs 자체 PostgreSQL 호스팅 - 확장성 고려?
- Next.js 서버와 Express 서버 분리 이유? 통합 가능한가?
- semo-remote-client(Electron) vs 서버 사이드 세션 관리 - 왜 Electron?

**결정 필요**:
- Multi-tenancy 전략 (DB 분리 vs 스키마 분리 vs Row-level)
- CDN 사용 여부 (정적 자산, 아바타 이미지)
- 로깅/모니터링 솔루션 (Sentry, DataDog 등)

---

## Spike (기술 검증 필요 사항)

### SPIKE-00-01: Supabase Realtime 성능 테스트

**목적**: Office당 8개 Agent, 100개 메시지/분 환경에서 Realtime 지연 시간 측정

**실험 계획**:
1. 테스트 Office 생성 (Agent 8개)
2. 초당 10개 메시지 브로드캐스트 (1분간)
3. 클라이언트 수신 지연 시간 측정
4. 연결 끊김 빈도 확인

**성공 기준**:
- 평균 지연 < 500ms
- 메시지 손실률 < 1%
- 재연결 시간 < 3초

**예상 시간**: 2일

---

### SPIKE-00-02: node-pty 안정성 검증

**목적**: node-pty 기반 Claude Code 세션의 장시간 안정성 확인

**실험 계획**:
1. 세션 30개 동시 생성
2. 각 세션에서 긴 작업 실행 (30분+)
3. 메모리 누수, 크래시 빈도 측정
4. 출력 파싱 정확도 확인

**성공 기준**:
- 30분 작업 중 크래시율 < 5%
- 메모리 증가 < 500MB/세션
- 출력 파싱 정확도 > 95%

**예상 시간**: 3일

---

### SPIKE-00-03: PixiJS 렌더링 성능 테스트

**목적**: Agent 30개, 60fps 유지 가능 여부 확인

**실험 계획**:
1. PixiJS Stage에 Agent 30개 렌더링
2. 애니메이션 (idle, working, blocked) 동시 실행
3. FPS, 메모리 사용량 측정
4. 모바일 브라우저 테스트

**성공 기준**:
- 데스크톱: 60fps 유지
- 모바일: 30fps 유지
- 초기 로딩 < 3초

**예상 시간**: 2일

---

### SPIKE-00-04: Git Worktree 충돌 처리

**목적**: 동시 Worktree에서 같은 파일 수정 시 머지 충돌 처리 전략 검증

**실험 계획**:
1. 2개 Worktree 생성 (FE, BE)
2. 같은 파일(shared type 정의) 동시 수정
3. PR 생성 및 머지 시도
4. 충돌 감지 및 해결 방법 테스트

**성공 기준**:
- 충돌 자동 감지
- rebase 시도 → 실패 시 사용자 알림
- 수동 해결 후 재시도 가능

**예상 시간**: 2일

---

### SPIKE-00-05: Task Decomposer 정확도 테스트

**목적**: 자연어 요청의 Job 분해 정확도 확인

**실험 계획**:
1. 10개 샘플 요청 준비 (간단 → 복잡)
2. Decomposer Agent 실행
3. 생성된 Job 개수, 역할 매칭, 의존성 정확도 평가
4. Few-shot 예제 튜닝

**성공 기준**:
- 역할 매칭 정확도 > 80%
- 의존성 그래프 유효성 > 90%
- 분해 실패율 < 10%

**예상 시간**: 3일

---

## Priority (우선순위)

| Spike | 우선순위 | 이유 |
|-------|---------|------|
| SPIKE-00-02 | 🔴 Critical | node-pty는 핵심 의존성, 실패 시 대안 필요 |
| SPIKE-00-01 | 🟠 High | Realtime은 UX 핵심, 지연 시 폴링 폴백 필요 |
| SPIKE-00-05 | 🟠 High | Decomposer 품질이 전체 시스템 정확도 결정 |
| SPIKE-00-04 | 🟡 Medium | 충돌은 예상 가능, 수동 해결 가능 |
| SPIKE-00-03 | 🟡 Medium | PixiJS 대체제 존재 (React Flow 등) |

---

## Risk Mitigation (리스크 완화)

### 만약 SPIKE-00-02 실패 시 (node-pty 불안정)

**대안 1**: Docker 컨테이너 기반 세션
- 각 Agent → 독립 Docker 컨테이너
- 더 무겁지만 격리 보장

**대안 2**: 서버 사이드 Claude API 직접 호출
- Claude Code CLI 대신 Anthropic API 직접 사용
- 터미널 세션 없이 API 기반 워크플로우

**대안 3**: 세션 풀 크기 축소
- Office당 최대 3개 동시 세션으로 제한
- 안정성 우선

### 만약 SPIKE-00-01 실패 시 (Realtime 지연)

**대안**: Polling 기반 동기화
- 5초마다 상태 폴링
- 실시간성 포기, 안정성 확보

---

## Next Steps

1. ✅ Spike 계획 수립 완료
2. ⏳ Spike 실행 순서 결정 (우선순위 기반)
3. ⏳ 각 Spike 결과 문서화 (`spike-results/`)
4. ⏳ 결과 기반 plan.md 업데이트
