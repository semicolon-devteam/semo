# 06-Realtime UI: Clarify & Spike

> PixiJS 기반 오피스 UI에 대한 불확실성 제거 및 기술 검증

---

## Clarify (명확화 필요 사항)

### 1. 아바타 디자인

**질문**:
- 아바타 스타일: 도트? 3D? 일러스트?
- 아바타 커스터마이징 가능?
- 애니메이션 프레임 수 (idle, working 등)?

**결정 필요**:
- 아바타 이미지 제작 방법 (디자이너? AI 생성?)
- 스프라이트 시트 사양 (크기, 포맷)
- 역할별 색상 코드 확정

### 2. 오피스 레이아웃

**질문**:
- 오피스 크기: 고정? 동적 확장?
- 가구 배치: 사전 정의? 사용자 커스텀?
- Agent 위치: 자동 배치? 드래그 가능?

**결정 필요**:
- 타일맵 크기 및 그리드 단위
- 충돌 감지 필요 여부
- 줌 레벨 범위 (0.5x ~ 2x?)

### 3. 실시간 동기화

**질문**:
- 상태 업데이트 주기: 실시간? 배치?
- 여러 사용자가 같은 Office 볼 때 동기화?
- 오프라인 시 상태 변경 누락 처리?

**결정 필요**:
- Presence 구독 범위 (Agent? User?)
- 상태 변경 큐잉 전략
- 동기화 충돌 해결 방법

### 4. UI 패널 구성

**질문**:
- 패널 레이아웃: 고정? 드래그 가능?
- 패널 최소화/최대화?
- 모바일 대응 방법?

**결정 필요**:
- 작업 진행 패널 표시 항목
- 대화 로그 필터 옵션
- 명령 입력창 자동완성 기능

---

## Spike (기술 검증 필요 사항)

### SPIKE-06-01: PixiJS 렌더링 성능

**목적**: Agent 30개 + 애니메이션 60fps 유지 가능 여부

**실험 계획**:
1. PixiJS Stage 생성, Agent 30개 렌더링
2. 각 Agent에 idle 애니메이션 (2fps)
3. 5개 Agent는 working 애니메이션 (4fps)
4. FPS, CPU 사용률, 메모리 측정

**성공 기준**:
- 데스크톱: 60fps 유지
- 모바일: 30fps 유지
- 메모리 사용량 < 500MB

**예상 시간**: 2일

---

### SPIKE-06-02: Supabase Realtime 구독 최적화

**목적**: 여러 채널 동시 구독 시 성능 측정

**실험 계획**:
1. Office Presence (agent:online)
2. Broadcast (agent_message, system_event)
3. Postgres Changes (office_agents, job_queue)
4. 3개 채널 동시 구독, 메시지 처리 지연 측정

**성공 기준**:
- 메시지 처리 지연 < 1초
- 채널별 독립성 보장
- 재연결 시 상태 동기화

**예상 시간**: 1일

---

### SPIKE-06-03: 아바타 스프라이트 애니메이션

**목적**: 스프라이트 시트 기반 애니메이션 구현 검증

**실험 계획**:
1. 간단한 도트 스타일 아바타 제작 (8x8px → 32x32px)
2. idle (2프레임), working (4프레임) 스프라이트 시트
3. PixiJS AnimatedSprite로 재생
4. 30개 동시 애니메이션 부하 테스트

**성공 기준**:
- 애니메이션 부드러움 (프레임 드랍 없음)
- 스프라이트 시트 로딩 < 1초
- 메모리 효율성 (재사용)

**예상 시간**: 2일

---

### SPIKE-06-04: Next.js + PixiJS 통합

**목적**: Next.js SSR 환경에서 PixiJS 동작 검증

**실험 계획**:
1. Next.js 14 App Router 환경
2. PixiJS를 Client Component로 로드
3. SSR/CSR 전환 시 상태 유지
4. Hydration 이슈 확인

**성공 기준**:
- SSR 오류 없음
- 클라이언트 렌더링 성공
- Hydration mismatch 없음

**예상 시간**: 1일

---

### SPIKE-06-05: 줌/팬 인터랙션

**목적**: 대형 오피스에서 줌/팬 UX 검증

**실험 계획**:
1. 2000x2000px 오피스 생성
2. 마우스 휠 줌 (0.5x ~ 2x)
3. 드래그 팬
4. 성능 및 UX 테스트

**성공 기준**:
- 줌/팬 부드러움 (60fps)
- 경계 처리 (오피스 밖 이동 방지)
- 터치 제스처 지원 (모바일)

**예상 시간**: 1일

---

## Decisions (결정 사항)

### ✅ 결정됨: 아바타 디자인

- **스타일**: 간단한 도트 스타일 (16x16px → 64x64px 렌더링)
- **색상**: 역할별 구분 (FE: 파랑, BE: 초록, QA: 빨강 등)
- **애니메이션**:
  - idle: 2프레임 (상하 움직임)
  - working: 4프레임 (빠른 움직임)
  - blocked: 2프레임 (깜빡임)
  - error: 빨간 테두리

### ✅ 결정됨: 오피스 레이아웃

```typescript
const OFFICE_CONFIG = {
  gridSize: 64,           // 타일 크기
  width: 20,              // 20 타일 = 1280px
  height: 15,             // 15 타일 = 960px
  background: 'office-bg-tile.png',
  furniture: [
    { type: 'desk', position: [2, 2] },
    { type: 'desk', position: [4, 2] },
    // ...
  ],
  agentSpawnPoints: [
    [3, 3], [5, 3], [7, 3], // FE 영역
    [3, 8], [5, 8], [7, 8], // BE 영역
    // ...
  ]
};
```

### ✅ 결정됨: UI 패널 레이아웃

```
┌─────────────────────────────────────────────┐
│  Header (Office 이름, 설정)                  │
├───────────────────┬─────────────────────────┤
│                   │  TaskProgress (300px)   │
│                   │  ┌────────────────────┐ │
│                   │  │ Job 목록            │ │
│  PixiJS Canvas    │  │ [FE] UI 구현        │ │
│  (OfficeStage)    │  │ [BE] API 구현       │ │
│                   │  │ [QA] 테스트 작성    │ │
│                   │  └────────────────────┘ │
│                   ├─────────────────────────┤
│                   │  MessageLog (300px)     │
│                   │  ┌────────────────────┐ │
│                   │  │ FE → BE: "API 확인" │ │
│                   │  │ QA: "테스트 중..."  │ │
│                   │  └────────────────────┘ │
├───────────────────┴─────────────────────────┤
│  CommandInput (하단 고정)                    │
│  [________________________] [전송]          │
└─────────────────────────────────────────────┘
```

### ✅ 결정됨: 실시간 동기화 전략

- **Presence**: Office 접속 시 자동 구독
- **Broadcast**: 모든 Agent 상태 변경 즉시 전파
- **Postgres Changes**: job_queue, office_agents 테이블 변경 감지
- **오프라인 처리**: 재연결 시 마지막 상태 조회 후 동기화

---

## Open Questions (미결정 사항)

| 질문 | 담당자 | 기한 |
|------|--------|------|
| 아바타 이미지 제작 방법 | Designer | Phase 3 |
| 모바일 대응 우선순위 | PO | Phase 8 |
| 패널 드래그 기능 필요? | UX | Phase 7 |
| 다크 모드 지원 | FE Dev | v0.2.0 |

---

## Risk Mitigation (리스크 완화)

### 만약 SPIKE-06-01 실패 시 (PixiJS 성능 부족)

**대안 1**: React Flow 사용
- PixiJS 대신 React Flow (SVG 기반)
- 성능은 낮지만 구현 간단

**대안 2**: Agent 수 제한
- Office당 최대 12개 Agent로 제한
- 성능 보장

**대안 3**: LOD (Level of Detail)
- 줌 아웃 시 간단한 도형으로 표시
- 줌 인 시 상세 렌더링

### 만약 SPIKE-06-03 실패 시 (애니메이션 제작 어려움)

**대안**: 정적 아바타
- 애니메이션 없이 상태별 단일 이미지
- 상태 변경 시 fade 전환 효과

---

## Next Steps

1. ✅ Clarify 문서 작성 완료
2. ⏳ SPIKE-06-01 최우선 실행 (PixiJS 성능)
3. ⏳ SPIKE-06-04 실행 (Next.js 통합)
4. ⏳ 아바타 스프라이트 시트 제작 의뢰 (Designer)
5. ⏳ Open Questions 답변 수집
