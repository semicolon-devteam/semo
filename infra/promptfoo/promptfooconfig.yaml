# Promptfoo Configuration
# SEMO Agent 품질 테스트 - Pass@k 메트릭 수집

description: "SEMO Agent 품질 평가"

# 테스트할 프롬프트 (Agent/Skill 시스템 프롬프트)
prompts:
  - file://../../packages/core/agents/orchestrator/orchestrator.md
  - file://../../packages/core/skills/notify-slack/SKILL.md

# 테스트할 모델
providers:
  - id: anthropic:claude-sonnet-4-20250514
    label: "Claude Sonnet 4 (기본)"
    config:
      max_tokens: 4096

  - id: anthropic:claude-3-5-haiku-20241022
    label: "Claude Haiku (빠른)"
    config:
      max_tokens: 2048

  - id: anthropic:claude-opus-4-20250514
    label: "Claude Opus 4 (고급)"
    config:
      max_tokens: 8192

# 테스트 케이스
tests:
  # === Orchestrator Agent 테스트 ===
  - description: "라우팅 정확도 - [next] 접두사"
    vars:
      input: "[next] API 호출 실패하는 버그 수정해줘"
    assert:
      - type: contains
        value: "sax-next"
      - type: contains
        value: "[SAX] Orchestrator"
      - type: llm-rubric
        value: |
          응답이 다음 기준을 만족하는지 평가:
          1. [next] 접두사를 올바르게 감지했는가?
          2. 적절한 Agent로 위임했는가?
          3. SAX 메시지 포맷을 준수했는가?

  - description: "라우팅 정확도 - [backend] 접두사"
    vars:
      input: "[backend] 데이터베이스 마이그레이션 스크립트 작성해줘"
    assert:
      - type: contains
        value: "sax-backend"
      - type: llm-rubric
        value: "백엔드 관련 작업으로 올바르게 라우팅했는가?"

  - description: "복합 패키지 라우팅 - [next | backend]"
    vars:
      input: "[next | backend] API 엔드포인트 추가하고 프론트에서 호출하게 해줘"
    assert:
      - type: llm-rubric
        value: |
          두 패키지(next, backend)에 모두 관련된 작업임을 인식하고
          적절한 작업 분할 또는 순차 처리를 제안했는가?

  # === Slack Skill 테스트 ===
  - description: "Slack 메시지 포맷팅"
    vars:
      input: "#_협업 채널에 '배포 완료' 메시지 보내줘"
    assert:
      - type: contains
        value: "#_협업"
      - type: not-contains
        value: "에러"
      - type: llm-rubric
        value: "올바른 Slack 채널과 메시지 형식을 사용했는가?"

  # === 엣지 케이스 ===
  - description: "접두사 없는 일반 질문"
    vars:
      input: "Git 사용법 알려줘"
    assert:
      - type: llm-rubric
        value: |
          패키지 접두사가 없는 일반 질문에 대해:
          1. 불필요한 패키지 라우팅을 하지 않았는가?
          2. 직접 답변을 제공했는가?

  - description: "잘못된 접두사 처리"
    vars:
      input: "[unknown] 뭔가 해줘"
    assert:
      - type: llm-rubric
        value: "알 수 없는 패키지 접두사에 대해 적절한 오류 메시지 또는 안내를 제공했는가?"

# 평가 설정
defaultTest:
  options:
    # Pass@k 설정: 각 테스트를 k번 실행
    repeat: 5

# 출력 설정
outputPath: ./results/latest.json

# 리포트 설정
sharing:
  enabled: false  # 외부 공유 비활성화
